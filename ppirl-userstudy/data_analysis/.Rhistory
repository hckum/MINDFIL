df_u_raw %>%
rename(u_id = uid) %>%
filter(type == "final_answer",
str_detect(extra, "record_linkage")) %>%
separate(value, into = c("q_id", "choice"), sep = "a", convert = T) %>%
left_join(df_q_info, by = "q_id") %>%
mutate(q_id = q_id %>% str_replace("p", "") %>% as.integer(),
confidence = if_else(choice > 3, choice - 3, abs(choice - 4)),
user_answer = if_else(choice > 3, 1, 0),
attention = q_type %in% attention_test)
df_u_raw %>%
rename(u_id = uid) %>%
filter(type == "final_answer",
str_detect(extra, "record_linkage")) %>%
separate(value, into = c("q_id", "choice"), sep = "a", convert = T) %>%
left_join(df_q_info, by = "q_id")
df_u_raw %>%
rename(u_id = uid) %>%
filter(type == "final_answer",
str_detect(extra, "record_linkage")) %>%
separate(value, into = c("q_id", "choice"), sep = "a") %>%
left_join(df_q_info, by = "q_id") %>%
df_u_raw %>%
rename(u_id = uid) %>%
filter(type == "final_answer",
str_detect(extra, "record_linkage")) %>%
separate(value, into = c("q_id", "choice"), sep = "a") %>%
left_join(df_q_info, by = "q_id")
df_u_raw %>%
rename(u_id = uid) %>%
filter(type == "final_answer",
str_detect(extra, "record_linkage")) %>%
separate(value, into = c("q_id", "choice"), sep = "a", convert = T) %>%
mutate(q_id = q_id %>% str_replace("p", "") %>% as.integer()) %>%
left_join(df_q_info, by = "q_id") %>%
mutate(confidence = if_else(choice > 3, choice - 3, abs(choice - 4)),
user_answer = if_else(choice > 3, 1, 0),
attention = q_type %in% attention_test)
df_u_raw %>%
rename(u_id = uid) %>%
filter(type == "final_answer",
str_detect(extra, "record_linkage")) %>%
separate(value, into = c("q_id", "choice"), sep = "a", convert = T) %>%
mutate(q_id = q_id %>% str_replace("p", "") %>% as.integer()) %>%
left_join(df_q_info, by = "q_id") %>%
mutate(confidence = if_else(choice > 3, choice - 3, abs(choice - 4)),
user_answer = if_else(choice > 3, 1, 0),
attention = q_type %in% attention_test) %>% filter(attention)
26*6
28*6
# question level user
df_u_question <-
df_u_raw %>%
rename(u_id = uid) %>%
filter(type == "final_answer",
str_detect(extra, "record_linkage")) %>%
separate(value, into = c("q_id", "choice"), sep = "a", convert = T) %>%
mutate(q_id = q_id %>% str_replace("p", "") %>% as.integer()) %>%
left_join(df_q_info, by = "q_id") %>%
mutate(confidence = if_else(choice > 3, choice - 3, abs(choice - 4)),
user_answer = if_else(choice > 3, 1, 0),
attention = q_type %in% attention_test) %>%
group_by(u_id, q_id) %>%
filter(timestamp == min(timestamp)) %>%
ungroup() %>%
mutate(grade = ifelse(user_answer == q_answer, 1, 0),
sample = as.integer(u_id)%%10) %>%
select(-type,-timestamp, -extra) %>%
mutate_if(is.character,as.integer) %>%
left_join(df_kapr_question, by = c("u_id", "q_id")) %>%
mutate(kapr_question = kapr_question %>% if_else(is.na(.), 0, .),
total_kapr_from_questions = sum(kapr_question))
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page) %>%
arrange(u_id, page) %>%
summarise(page_score = mean(grade[!attention]),
attention = sum(grade[attention]))
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
filter(page == 3)
filter(page == 3 & u_id == 2001)
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>% filter(page == 3 % id == 2001)
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>% filter(page == 3 & id == 2001)
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>% filter(page == 3 & u_id == 2001)
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page) %>%
arrange(u_id, page) %>%
summarise(page_score = mean(grade[!attention]),
attention = sum(grade[attention]))
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page) %>%
arrange(u_id, page) %>%
summarise(page_score = mean(grade[!attention]),
attention = sum(grade[attention]))
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page) %>%
arrange(u_id, page) %>%
summarise(page_score = mean(grade[!attention]),
attention = sum(grade[attention])) %>%
ungroup() %>%
mutate(page = str_c("page_", page, "_score"),
page_attention = str_replace(page, "attention"))
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page) %>%
arrange(u_id, page) %>%
summarise(page_score = mean(grade[!attention]),
attention = sum(grade[attention])) %>%
ungroup() %>%
mutate(page = str_c("page_", page, "_score"),
page_attention = str_replace(page, "score", "attention"))
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page) %>%
arrange(u_id, page) %>%
summarise(page_score = mean(grade[!attention]),
attention = sum(grade[attention])) %>%
ungroup() %>%
mutate(page = str_c("page_", page, "_score"),
page_attention = str_replace(page, "score", "attention")) %>%
spread(page, page_score)
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page) %>%
arrange(u_id, page) %>%
summarise(page_score = mean(grade[!attention]),
attention = sum(grade[attention])) %>%
ungroup() %>%
mutate(page = str_c("page_", page, "_score")) %>%
spread(page, page_score)
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page) %>%
arrange(u_id, page) %>%
summarise(page_score = mean(grade[!attention]),
attention = sum(grade[attention])) %>%
ungroup()
df_score_attention <-
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page) %>%
arrange(u_id, page) %>%
summarise(page_score = mean(grade[!attention]),
attention = sum(grade[attention])) %>%
ungroup()
df_score_attention %>%
select(u_id, page, page_score) %>%
mutate(page = str_c("page_", page, "_score")) %>%
spread(page, page_score)
df_score_attention %>%
select(u_id, page, attention) %>%
mutate(page = str_c("page_", page, "_attention")) %>%
spread(page, attention)
df_score_attention_page <-
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page) %>%
arrange(u_id, page) %>%
summarise(page_score = mean(grade[!attention]),
attention = sum(grade[attention])) %>%
ungroup()
df_attention_page <-
df_score_attention_page %>%
select(u_id, page, attention) %>%
mutate(page = str_c("page_", page, "_attention")) %>%
spread(page, attention)
df_attention_page
df_page_attention <-
df_score_attention_page %>%
select(u_id, page, attention) %>%
mutate(page = str_c("page_", page, "_attention")) %>%
spread(page, attention)
df_u_key_info <-
df_u_question %>%
filter(u_id != 2) %>%
group_by(u_id, sample) %>%
summarise(grade36 = sum(grade),
grade30 = sum(grade[!(q_type %in% attention_test)]),
percent_attention = mean(grade[q_type %in% attention_test]),
percent_attention = ifelse(is.nan(percent_attention), 1, percent_attention),
percent36 = mean(grade)*100,
percent30 = mean(grade[!(q_type %in% attention_test)]) *100,
mean_confidence = mean(confidence),
mean_confidence_right = mean(confidence[grade == 1]),
mean_confidence_wrong = mean(confidence[grade == 0]),
total_kapr_from_questions = total_kapr_from_questions %>% mean()) %>%
ungroup() %>%
left_join(df_kapr_user, "u_id") %>%
left_join(df_kapr_page, "u_id") %>%
left_join(df_u_mode, "u_id") %>%
left_join(df_page_attention, "u_id") %>%
left_join(df_page_score, "u_id") %>%
select(-total_kapr_from_questions, -total_kapr_from_pages)
pacman::p_load(tidyverse, rebus, glue)
df_u_raw <- read_csv("mindfil4-3-20.csv")
df_q_raw <- read_csv("main_section_full.csv")
df_q_type_ordering <-
read_csv("scrambled_order.csv") %>%
select(-qnum, q_type = type)
df_q_info <-
df_q_raw %>%
select(q_id = `Group ID`,
q_answer = Same,
q_type = `Record ID`) %>%
group_by(q_id) %>%
slice(1) %>%
ungroup() %>%
mutate_all(as.integer)
df_u_mode <-
df_u_raw %>%
filter(type == "session_start") %>%
mutate(mode = extra %>% str_extract(DGT %R% END)) %>%
select(u_id = uid, mode)
# each cell click info
df_kapr_cell <-
df_u_raw %>%
filter(type == "kapr",
str_detect(extra, "record_linkage")) %>%
rename(u_id = uid,
kapr_cumulative = value) %>%
mutate(url = str_extract(extra, "url" %R% one_or_more(or(PUNCT, WRD))) %>% str_replace("url:", ""),
kapr_cumulative = kapr_cumulative %>% as.double(),
open_cell = str_extract(extra, "id:" %R% one_or_more(or(DGT, literal("-")))) %>% str_replace("id:", ""),
q_id = str_extract(open_cell, one_or_more(DGT)),
column_id = str_extract(open_cell, DGT %R% END) %>% as.integer(),
cell_mode = extra %>% str_extract("new_mode:" %R% one_or_more(ALPHA)) %>% str_replace("new_mode:", ""),
column = case_when(
column_id == 0 ~ "reg",
column_id == 1 ~ "fname",
column_id == 2 ~ "lname",
column_id == 3 ~ "dob",
column_id == 4 ~ "sex",
TRUE ~ "race"
)) %>%
group_by(u_id) %>%
arrange(u_id, timestamp) %>%
mutate(kapr_cell = (kapr_cumulative - lag(kapr_cumulative)) %>% if_else(is.na(.), kapr_cumulative, .)) %>%
select(u_id, timestamp, q_id, column, cell_mode, starts_with("kapr")) %>%
ungroup()
df_kapr_question <-
df_kapr_cell %>%
group_by(u_id, q_id) %>%
summarise(kapr_question = sum(kapr_cell), timestamp = min(timestamp)) %>%
ungroup() %>%
mutate_if(is.character,as.integer)
# kapr for each user
df_kapr_user <-
df_u_raw %>%
filter(type == "kapr",
str_detect(extra, "record_linkage")) %>%
mutate(mode_url = extra %>% str_replace("id:" %R% one_or_more(or(DGT,PUNCT)), ""),
value = value %>% as.numeric()) %>%
group_by(uid) %>%
filter(value == max(value)) %>%
ungroup() %>%
arrange(uid) %>%
ungroup() %>%
select(u_id = uid, kapr = value)
attention_test <- c(1,7,13,19,25,31)
# question level user
df_u_question <-
df_u_raw %>%
rename(u_id = uid) %>%
filter(type == "final_answer",
str_detect(extra, "record_linkage")) %>%
separate(value, into = c("q_id", "choice"), sep = "a", convert = T) %>%
mutate(q_id = q_id %>% str_replace("p", "") %>% as.integer()) %>%
left_join(df_q_info, by = "q_id") %>%
mutate(confidence = if_else(choice > 3, choice - 3, abs(choice - 4)),
user_answer = if_else(choice > 3, 1, 0),
attention = q_type %in% attention_test) %>%
group_by(u_id, q_id) %>%
filter(timestamp == min(timestamp)) %>%
ungroup() %>%
mutate(grade = ifelse(user_answer == q_answer, 1, 0),
sample = as.integer(u_id)%%10) %>%
select(-type,-timestamp, -extra) %>%
mutate_if(is.character,as.integer) %>%
left_join(df_kapr_question, by = c("u_id", "q_id")) %>%
mutate(kapr_question = kapr_question %>% if_else(is.na(.), 0, .),
total_kapr_from_questions = sum(kapr_question))
df_score_attention_page <-
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page) %>%
arrange(u_id, page) %>%
summarise(page_score = mean(grade[!attention]),
attention = sum(grade[attention])) %>%
ungroup()
df_page_score <-
df_score_attention_page %>%
select(u_id, page, page_score) %>%
mutate(page = str_c("page_", page, "_score")) %>%
spread(page, page_score)
df_page_attention <-
df_score_attention_page %>%
select(u_id, page, attention) %>%
mutate(page = str_c("page_", page, "_attention")) %>%
spread(page, attention)
df_kapr_page <-
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page) %>%
summarise(kapr_page = sum(kapr_question)) %>%
mutate(page = str_c("page_", page, "_kapr")) %>%
spread(page, kapr_page) %>%
ungroup() %>%
mutate(total_kapr_from_pages = page_1_kapr + page_2_kapr + page_3_kapr + page_4_kapr + page_5_kapr + page_6_kapr)
df_u_key_info <-
df_u_question %>%
filter(u_id != 2) %>%
group_by(u_id, sample) %>%
summarise(grade36 = sum(grade),
grade30 = sum(grade[!(q_type %in% attention_test)]),
percent_attention = mean(grade[q_type %in% attention_test]),
percent_attention = ifelse(is.nan(percent_attention), 1, percent_attention),
percent36 = mean(grade)*100,
percent30 = mean(grade[!(q_type %in% attention_test)]) *100,
mean_confidence = mean(confidence),
mean_confidence_right = mean(confidence[grade == 1]),
mean_confidence_wrong = mean(confidence[grade == 0]),
total_kapr_from_questions = total_kapr_from_questions %>% mean()) %>%
ungroup() %>%
left_join(df_kapr_user, "u_id") %>%
left_join(df_kapr_page, "u_id") %>%
left_join(df_u_mode, "u_id") %>%
left_join(df_page_attention, "u_id") %>%
left_join(df_page_score, "u_id") %>%
select(-total_kapr_from_questions, -total_kapr_from_pages)
df_u_key_info %>%
filter(u_id != 2) %>%
mutate(mode = str_sub(u_id,1,1)) %>%
group_by(mode) %>%
summarise_all(mean) %>%
View
df_u_key_info <-
df_u_question %>%
filter(u_id != 2) %>%
group_by(u_id, sample) %>%
summarise(grade36 = sum(grade),
grade30 = sum(grade[!(q_type %in% attention_test)]),
percent_attention = mean(grade[q_type %in% attention_test]),
percent_attention = ifelse(is.nan(percent_attention), 1, percent_attention),
percent36 = mean(grade)*100,
percent30 = mean(grade[!(q_type %in% attention_test)]) *100,
mean_confidence = mean(confidence),
mean_confidence_right = mean(confidence[grade == 1]),
mean_confidence_wrong = mean(confidence[grade == 0]),
total_kapr_from_questions = total_kapr_from_questions %>% mean()) %>%
ungroup() %>%
left_join(df_kapr_user, "u_id") %>%
left_join(df_kapr_page, "u_id") %>%
left_join(df_u_mode, "u_id") %>%
left_join(df_page_attention, "u_id") %>%
left_join(df_page_score, "u_id") %>%
select(-total_kapr_from_questions, -total_kapr_from_pages)
View(df_u_key_info)
for(i in objects()){
item <- get(i)
print(item)
if("data.frame" %in% class(item)){
write_csv(item, paste0("parsed/", i, ".csv"))
}
}
key_info <- read_csv("parsed/df_key_info.csv")
key_info <- read_csv("parsed/df_u_key_info.csv")
by_mode <-
key_info %>%
mutate(mode = str_sub(u_id,1,1))
by_mode %>%
group_by(mode) %>%
summarise_all(mean) %>%
select(mode, starts_with("page")) %>%
gather("page", "kapr", 2:7) %>%
mutate(page = str_extract(page, DGT) %>% as.integer()) %>%
ggplot(aes(page, kapr, col = mode)) +
geom_line()
by_mode[by_mode$u_id == 2004, "page_2_kapr"] = 2
by_mode %>%
group_by(mode) %>%
summarise_all(mean) %>%
select(mode, starts_with("page")) %>%
gather("page", "kapr", 2:7) %>%
mutate(page = str_extract(page, DGT) %>% as.integer()) %>%
ggplot(aes(page, kapr, col = mode)) +
geom_line()
group_by(mode) %>%
summarise_all(mean) %>%
select(mode, starts_with("page")) %>%
gather("page", "kapr", 2:7)
by_mode %>%
group_by(mode) %>%
summarise_all(mean) %>%
select(mode, starts_with("page")) %>%
gather("page", "kapr", 2:7)
by_mode
by_mode %>%
group_by(mode) %>%
summarise_all(mean) %>%
select(mode, starts_with("page"))
by_mode %>%
group_by(mode) %>%
summarise_all(mean) %>%
select(mode, starts_with("page")) %>%
gather("page", "kapr", 2:7)
by_mode %>%
group_by(mode) %>%
summarise_all(mean) %>%
select(mode, starts_with("page")) %>%
gather("page", "kapr", 2:7) %>%
gather("page", "attention", 2:7)
by_mode %>%
group_by(mode) %>%
summarise_all(mean) %>%
select(mode, starts_with("page")) %>%
gather("page", "kapr", 2:7) %>%
gather("page2", "attention", 2:7)
by_mode %>%
group_by(mode) %>%
summarise_all(mean) %>%
select(mode, starts_with("page")) %>%
gather("page", "kapr", 2:7) %>%
gather("page2", "attention", 2:7) %>%
gather("page3", "score", 2:7)
by_mode %>%
group_by(mode) %>%
summarise_all(mean) %>%
select(mode, starts_with("page")) %>%
gather("page", "kapr", 2:7) %>%
gather("page2", "attention", 2:7) %>%
gather("page3", "score", 2:7) %>%
mutate(page = str_extract(page, DGT) %>% as.integer(),
page2 = str_extract(page2, DGT) %>% as.integer(),
page3 = str_extract(page3, DGT) %>% as.integer()) %>%
ggplot(aes(page, kapr, col = mode)) +
geom_line()
by_mode %>%
group_by(mode) %>%
summarise_all(mean) %>%
select(mode, starts_with("page")) %>%
gather("page", "kapr", 2:7) %>%
gather("page2", "attention", 2:7) %>%
gather("page3", "score", 2:7) %>%
mutate(page = str_extract(page, DGT) %>% as.integer(),
page2 = str_extract(page2, DGT) %>% as.integer(),
page3 = str_extract(page3, DGT) %>% as.integer())
by_mode %>%
group_by(mode) %>%
summarise_all(mean) %>%
select(mode, starts_with("page")) %>%
gather("page", "kapr", 2:7) %>%
mutate(page = str_extract(page, DGT) %>% as.integer()) %>%
ggplot(aes(page, kapr, col = mode)) +
geom_line() +
geom_line()
by_mode %>%
group_by(mode) %>%
summarise_all(mean) %>%
select(mode, starts_with("page")) %>%
select(mode, ends_with("score"))
by_mode %>%
group_by(mode) %>%
summarise_all(mean) %>%
select(mode, starts_with("page")) %>%
select(mode, ends_with("score")) %>%
gather("page", "score", 2:7)
by_mode %>%
group_by(mode) %>%
summarise_all(mean) %>%
select(mode, starts_with("page")) %>%
select(mode, ends_with("score")) %>%
gather("page", "score", 2:7) %>%
mutate(score = str_extract(score, DGT) %>% as.integer()) %>%
ggplot(aes(page, score, col = mode)) +
geom_line()
by_mode %>%
group_by(mode) %>%
summarise_all(mean) %>%
select(mode, starts_with("page")) %>%
select(mode, ends_with("score")) %>%
gather("page", "score", 2:7) %>%
mutate(score = str_extract(score, DGT) %>% as.integer())
by_mode
by_mode %>%
group_by(mode) %>%
summarise_all(mean) %>%
select(mode, starts_with("page")) %>%
select(mode, ends_with("score"))
by_mode %>%
group_by(mode) %>%
summarise_all(mean) %>%
select(mode, starts_with("page")) %>%
select(mode, ends_with("score")) %>%
gather("page", "score", 2:7)
by_mode %>%
group_by(mode) %>%
summarise_all(mean) %>%
select(mode, starts_with("page")) %>%
select(mode, ends_with("score")) %>%
gather("page", "score", 2:7) %>%
mutate(page = str_extract(page, DGT) %>% as.integer()) %>%
ggplot(aes(page, score, col = mode)) +
geom_line()
View(by_mode)
by_mode %>% filter(mode == 3) %>% View
