filter(type == "final_answer",
str_detect(extra, "record_linkage")) %>%
separate(value, into = c("q_id", "choice"), sep = "a", convert = T) %>%
mutate(q_id = q_id %>% str_replace("p", "") %>% as.integer(),
confidence = if_else(choice > 3, choice - 3, abs(choice - 4)),
user_answer = if_else(choice > 3, 1, 0),
attention = q_id %in% attention_test) %>%
filter(u_id == 2004, q_id == 123) %>%
left_join(df_q_info) %>%
left_join(df_q_type_ordering)
df_u_raw %>%
rename(u_id = uid) %>%
filter(type == "final_answer",
str_detect(extra, "record_linkage")) %>%
separate(value, into = c("q_id", "choice"), sep = "a", convert = T) %>%
mutate(q_id = q_id %>% str_replace("p", "") %>% as.integer(),
confidence = if_else(choice > 3, choice - 3, abs(choice - 4)),
user_answer = if_else(choice > 3, 1, 0),
attention = q_id %in% attention_test) %>%
filter(u_id == 2004, q_id == 279) %>%
left_join(df_q_info) %>%
left_join(df_q_type_ordering)
# question level user
df_u_question <-
df_u_raw %>%
rename(u_id = uid) %>%
filter(type == "final_answer",
str_detect(extra, "record_linkage")) %>%
separate(value, into = c("q_id", "choice"), sep = "a", convert = T) %>%
mutate(q_id = q_id %>% str_replace("p", "") %>% as.integer(),
confidence = if_else(choice > 3, choice - 3, abs(choice - 4)),
user_answer = if_else(choice > 3, 1, 0),
attention = q_id %in% attention_test) %>%
group_by(u_id, q_id) %>%
filter(timestamp == min(timestamp)) %>%
ungroup() %>%
left_join(df_q_info, by = "q_id") %>%
mutate(grade = ifelse(user_answer == q_answer, 1, 0),
sample = as.integer(u_id)%%10) %>%
select(-type,-timestamp, -extra) %>%
mutate_if(is.character,as.integer) %>%
left_join(df_kapr_question, by = c("u_id", "q_id")) %>%
mutate(kapr_question = kapr_question %>% if_else(is.na(.), 0, .),
total_kapr_from_questions = sum(kapr_question))
df_kapr_page <-
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page) %>%
summarise(kapr_page = sum(kapr_question)) %>%
mutate(page = str_c("page_", page, "_kapr")) %>%
spread(page, kapr_page) %>%
ungroup() %>%
mutate(total_kapr_from_pages = page_1_kapr + page_2_kapr + page_3_kapr + page_4_kapr + page_5_kapr)
df_u_key_info <-
df_u_question %>%
group_by(u_id, sample) %>%
summarise(grade36 = sum(grade),
grade30 = sum(grade[!(q_type %in% attention_test)]),
percent_attention = mean(grade[q_type %in% attention_test]),
percent_attention = ifelse(is.nan(percent_attention), 1, percent_attention),
percent36 = mean(grade)*100,
percent30 = mean(grade[!(q_type %in% attention_test)]) *100,
mean_confidence = mean(confidence),
mean_confidence_right = mean(confidence[grade == 1]),
mean_confidence_wrong = mean(confidence[grade == 0])) %>%
ungroup() %>%
left_join(df_kapr_user, "u_id") %>%
left_join(df_kapr_page, "u_id") %>%
left_join(df_u_mode, "u_id")
df_u_key_info %>%
filter(u_id != 2) %>%
mutate(mode = str_sub(u_id,1,1)) %>%
group_by(mode) %>%
summarise_all(mean) %>%
View
# question level user
df_u_question <-
df_u_raw %>%
rename(u_id = uid) %>%
filter(type == "final_answer",
str_detect(extra, "record_linkage")) %>%
separate(value, into = c("q_id", "choice"), sep = "a", convert = T) %>%
mutate(q_id = q_id %>% str_replace("p", "") %>% as.integer(),
confidence = if_else(choice > 3, choice - 3, abs(choice - 4)),
user_answer = if_else(choice > 3, 1, 0),
attention = q_id %in% attention_test) %>%
group_by(u_id, q_id) %>%
filter(timestamp == msx(timestamp)) %>%
ungroup() %>%
left_join(df_q_info, by = "q_id") %>%
mutate(grade = ifelse(user_answer == q_answer, 1, 0),
sample = as.integer(u_id)%%10) %>%
select(-type,-timestamp, -extra) %>%
mutate_if(is.character,as.integer) %>%
left_join(df_kapr_question, by = c("u_id", "q_id")) %>%
mutate(kapr_question = kapr_question %>% if_else(is.na(.), 0, .),
total_kapr_from_questions = sum(kapr_question))
# question level user
df_u_question <-
df_u_raw %>%
rename(u_id = uid) %>%
filter(type == "final_answer",
str_detect(extra, "record_linkage")) %>%
separate(value, into = c("q_id", "choice"), sep = "a", convert = T) %>%
mutate(q_id = q_id %>% str_replace("p", "") %>% as.integer(),
confidence = if_else(choice > 3, choice - 3, abs(choice - 4)),
user_answer = if_else(choice > 3, 1, 0),
attention = q_id %in% attention_test) %>%
group_by(u_id, q_id) %>%
filter(timestamp == max(timestamp)) %>%
ungroup() %>%
left_join(df_q_info, by = "q_id") %>%
mutate(grade = ifelse(user_answer == q_answer, 1, 0),
sample = as.integer(u_id)%%10) %>%
select(-type,-timestamp, -extra) %>%
mutate_if(is.character,as.integer) %>%
left_join(df_kapr_question, by = c("u_id", "q_id")) %>%
mutate(kapr_question = kapr_question %>% if_else(is.na(.), 0, .),
total_kapr_from_questions = sum(kapr_question))
df_kapr_page <-
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page) %>%
summarise(kapr_page = sum(kapr_question)) %>%
mutate(page = str_c("page_", page, "_kapr")) %>%
spread(page, kapr_page) %>%
ungroup() %>%
mutate(total_kapr_from_pages = page_1_kapr + page_2_kapr + page_3_kapr + page_4_kapr + page_5_kapr)
df_u_key_info <-
df_u_question %>%
group_by(u_id, sample) %>%
summarise(grade36 = sum(grade),
grade30 = sum(grade[!(q_type %in% attention_test)]),
percent_attention = mean(grade[q_type %in% attention_test]),
percent_attention = ifelse(is.nan(percent_attention), 1, percent_attention),
percent36 = mean(grade)*100,
percent30 = mean(grade[!(q_type %in% attention_test)]) *100,
mean_confidence = mean(confidence),
mean_confidence_right = mean(confidence[grade == 1]),
mean_confidence_wrong = mean(confidence[grade == 0])) %>%
ungroup() %>%
left_join(df_kapr_user, "u_id") %>%
left_join(df_kapr_page, "u_id") %>%
left_join(df_u_mode, "u_id")
df_u_key_info %>%
filter(u_id != 2) %>%
mutate(mode = str_sub(u_id,1,1)) %>%
group_by(mode) %>%
summarise_all(mean) %>%
View
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page) %>%
summarise(kapr_page = sum(kapr_question)) %>%
mutate(page = str_c("page_", page, "_kapr")) %>%
spread(page, kapr_page) %>%
ungroup()
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page)
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id) %>% summarise(sum(kapr_question))
View(df_u_key_info)
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id,page) %>% summarise(sum(kapr_question))
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id,page) %>% summarise(sum(kapr_question)) %>% mutate(k = sum(`sum(kapr_question)`))
df_kapr_page <-
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page) %>%
summarise(kapr_page = sum(kapr_question))
df_kapr_page <-
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page) %>%
summarise(kapr_page = sum(kapr_question)) %>%
mutate(page = str_c("page_", page, "_kapr"))
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page) %>%
summarise(kapr_page = sum(kapr_question)) %>%
mutate(page = str_c("page_", page, "_kapr"))
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page) %>%
summarise(kapr_page = sum(kapr_question)) %>%
mutate(page = str_c("page_", page, "_kapr")) %>%
spread(page, kapr_page)
df_kapr_page <-
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page) %>%
summarise(kapr_page = sum(kapr_question)) %>%
mutate(page = str_c("page_", page, "_kapr")) %>%
spread(page, kapr_page) %>%
ungroup() %>%
mutate(total_kapr_from_pages = page_1_kapr + page_2_kapr + page_3_kapr + page_4_kapr + page_5_kapr + page_6_kapr)
df_kapr_page
df_u_key_info <-
df_u_question %>%
group_by(u_id, sample) %>%
summarise(grade36 = sum(grade),
grade30 = sum(grade[!(q_type %in% attention_test)]),
percent_attention = mean(grade[q_type %in% attention_test]),
percent_attention = ifelse(is.nan(percent_attention), 1, percent_attention),
percent36 = mean(grade)*100,
percent30 = mean(grade[!(q_type %in% attention_test)]) *100,
mean_confidence = mean(confidence),
mean_confidence_right = mean(confidence[grade == 1]),
mean_confidence_wrong = mean(confidence[grade == 0])) %>%
ungroup() %>%
left_join(df_kapr_user, "u_id") %>%
left_join(df_kapr_page, "u_id") %>%
left_join(df_u_mode, "u_id")
df_u_key_info <-
df_u_question %>%
group_by(u_id, sample) %>%
summarise(grade36 = sum(grade),
grade30 = sum(grade[!(q_type %in% attention_test)]),
percent_attention = mean(grade[q_type %in% attention_test]),
percent_attention = ifelse(is.nan(percent_attention), 1, percent_attention),
percent36 = mean(grade)*100,
percent30 = mean(grade[!(q_type %in% attention_test)]) *100,
mean_confidence = mean(confidence),
mean_confidence_right = mean(confidence[grade == 1]),
mean_confidence_wrong = mean(confidence[grade == 0])) %>%
ungroup() %>%
left_join(df_kapr_user, "u_id") %>%
left_join(df_kapr_page, "u_id") %>%
left_join(df_u_mode, "u_id") %>% filter(near(kapr, total_kapr_from_pages))
df_u_key_info <-
df_u_question %>%
group_by(u_id, sample) %>%
summarise(grade36 = sum(grade),
grade30 = sum(grade[!(q_type %in% attention_test)]),
percent_attention = mean(grade[q_type %in% attention_test]),
percent_attention = ifelse(is.nan(percent_attention), 1, percent_attention),
percent36 = mean(grade)*100,
percent30 = mean(grade[!(q_type %in% attention_test)]) *100,
mean_confidence = mean(confidence),
mean_confidence_right = mean(confidence[grade == 1]),
mean_confidence_wrong = mean(confidence[grade == 0])) %>%
ungroup() %>%
left_join(df_kapr_user, "u_id") %>%
left_join(df_kapr_page, "u_id") %>%
left_join(df_u_mode, "u_id") %>%
select(-total_kapr_from_questions, -total_kapr_from_pages)
df_u_question %>%
group_by(u_id, sample) %>%
summarise(grade36 = sum(grade),
grade30 = sum(grade[!(q_type %in% attention_test)]),
percent_attention = mean(grade[q_type %in% attention_test]),
percent_attention = ifelse(is.nan(percent_attention), 1, percent_attention),
percent36 = mean(grade)*100,
percent30 = mean(grade[!(q_type %in% attention_test)]) *100,
mean_confidence = mean(confidence),
mean_confidence_right = mean(confidence[grade == 1]),
mean_confidence_wrong = mean(confidence[grade == 0])) %>%
ungroup() %>%
left_join(df_kapr_user, "u_id") %>%
left_join(df_kapr_page, "u_id") %>%
left_join(df_u_mode, "u_id")
df_u_key_info <-
df_u_question %>%
group_by(u_id, sample) %>%
summarise(grade36 = sum(grade),
grade30 = sum(grade[!(q_type %in% attention_test)]),
percent_attention = mean(grade[q_type %in% attention_test]),
percent_attention = ifelse(is.nan(percent_attention), 1, percent_attention),
percent36 = mean(grade)*100,
percent30 = mean(grade[!(q_type %in% attention_test)]) *100,
mean_confidence = mean(confidence),
mean_confidence_right = mean(confidence[grade == 1]),
mean_confidence_wrong = mean(confidence[grade == 0])) %>%
ungroup() %>%
left_join(df_kapr_user, "u_id") %>%
left_join(df_kapr_page, "u_id") %>%
left_join(df_u_mode, "u_id") %>%
select(-total_kapr_from_questions, -total_kapr_from_pages)
df_u_key_info
df_kapr_page <-
df_u_question %>%
left_join(df_q_type_ordering, "q_type") %>%
group_by(u_id, page) %>%
summarise(kapr_page = sum(kapr_question)) %>%
mutate(page = str_c("page_", page, "_kapr")) %>%
spread(page, kapr_page) %>%
ungroup() %>%
mutate(total_kapr_from_pages = page_1_kapr + page_2_kapr + page_3_kapr + page_4_kapr + page_5_kapr + page_6_kapr)
df_u_key_info <-
df_u_question %>%
group_by(u_id, sample) %>%
summarise(grade36 = sum(grade),
grade30 = sum(grade[!(q_type %in% attention_test)]),
percent_attention = mean(grade[q_type %in% attention_test]),
percent_attention = ifelse(is.nan(percent_attention), 1, percent_attention),
percent36 = mean(grade)*100,
percent30 = mean(grade[!(q_type %in% attention_test)]) *100,
mean_confidence = mean(confidence),
mean_confidence_right = mean(confidence[grade == 1]),
mean_confidence_wrong = mean(confidence[grade == 0])) %>%
ungroup() %>%
left_join(df_kapr_user, "u_id") %>%
left_join(df_kapr_page, "u_id") %>%
left_join(df_u_mode, "u_id") %>%
select(-total_kapr_from_questions, -total_kapr_from_pages)
df_kapr_page
df_u_question %>%
group_by(u_id, sample) %>%
summarise(grade36 = sum(grade),
grade30 = sum(grade[!(q_type %in% attention_test)]),
percent_attention = mean(grade[q_type %in% attention_test]),
percent_attention = ifelse(is.nan(percent_attention), 1, percent_attention),
percent36 = mean(grade)*100,
percent30 = mean(grade[!(q_type %in% attention_test)]) *100,
mean_confidence = mean(confidence),
mean_confidence_right = mean(confidence[grade == 1]),
mean_confidence_wrong = mean(confidence[grade == 0])) %>%
ungroup() %>%
left_join(df_kapr_user, "u_id") %>%
left_join(df_kapr_page, "u_id") %>%
left_join(df_u_mode, "u_id")
# question level user
df_u_question <-
df_u_raw %>%
rename(u_id = uid) %>%
filter(type == "final_answer",
str_detect(extra, "record_linkage")) %>%
separate(value, into = c("q_id", "choice"), sep = "a", convert = T) %>%
mutate(q_id = q_id %>% str_replace("p", "") %>% as.integer(),
confidence = if_else(choice > 3, choice - 3, abs(choice - 4)),
user_answer = if_else(choice > 3, 1, 0),
attention = q_id %in% attention_test) %>%
group_by(u_id, q_id) %>%
filter(timestamp == min(timestamp)) %>%
ungroup() %>%
left_join(df_q_info, by = "q_id") %>%
mutate(grade = ifelse(user_answer == q_answer, 1, 0),
sample = as.integer(u_id)%%10) %>%
select(-type,-timestamp, -extra) %>%
mutate_if(is.character,as.integer) %>%
left_join(df_kapr_question, by = c("u_id", "q_id")) %>%
mutate(kapr_question = kapr_question %>% if_else(is.na(.), 0, .),
total_kapr_from_questions = sum(kapr_question))
df_u_key_info <-
df_u_question %>%
group_by(u_id, sample) %>%
summarise(grade36 = sum(grade),
grade30 = sum(grade[!(q_type %in% attention_test)]),
percent_attention = mean(grade[q_type %in% attention_test]),
percent_attention = ifelse(is.nan(percent_attention), 1, percent_attention),
percent36 = mean(grade)*100,
percent30 = mean(grade[!(q_type %in% attention_test)]) *100,
mean_confidence = mean(confidence),
mean_confidence_right = mean(confidence[grade == 1]),
mean_confidence_wrong = mean(confidence[grade == 0])) %>%
ungroup() %>%
left_join(df_kapr_user, "u_id") %>%
left_join(df_kapr_page, "u_id") %>%
left_join(df_u_mode, "u_id") %>%
select(-total_kapr_from_questions, -total_kapr_from_pages)
df_u_key_info <-
df_u_question %>%
group_by(u_id, sample) %>%
summarise(grade36 = sum(grade),
grade30 = sum(grade[!(q_type %in% attention_test)]),
percent_attention = mean(grade[q_type %in% attention_test]),
percent_attention = ifelse(is.nan(percent_attention), 1, percent_attention),
percent36 = mean(grade)*100,
percent30 = mean(grade[!(q_type %in% attention_test)]) *100,
mean_confidence = mean(confidence),
mean_confidence_right = mean(confidence[grade == 1]),
mean_confidence_wrong = mean(confidence[grade == 0])) %>%
ungroup() %>%
left_join(df_kapr_user, "u_id") %>%
left_join(df_kapr_page, "u_id") %>%
left_join(df_u_mode, "u_id") %>%
select(-total_kapr_from_questions, -total_kapr_from_pages)
# question level user
df_u_question <-
df_u_raw %>%
rename(u_id = uid) %>%
filter(type == "final_answer",
str_detect(extra, "record_linkage")) %>%
separate(value, into = c("q_id", "choice"), sep = "a", convert = T) %>%
mutate(q_id = q_id %>% str_replace("p", "") %>% as.integer(),
confidence = if_else(choice > 3, choice - 3, abs(choice - 4)),
user_answer = if_else(choice > 3, 1, 0),
attention = q_id %in% attention_test) %>%
group_by(u_id, q_id) %>%
filter(timestamp == min(timestamp)) %>%
ungroup() %>%
left_join(df_q_info, by = "q_id") %>%
mutate(grade = ifelse(user_answer == q_answer, 1, 0),
sample = as.integer(u_id)%%10) %>%
select(-type,-timestamp, -extra) %>%
mutate_if(is.character,as.integer) %>%
left_join(df_kapr_question, by = c("u_id", "q_id")) %>%
mutate(kapr_question = kapr_question %>% if_else(is.na(.), 0, .),
total_kapr_from_questions = sum(kapr_question))
df_u_question
df_u_question
df_u_question %>%
group_by(u_id, sample) %>%
summarise(grade36 = sum(grade),
grade30 = sum(grade[!(q_type %in% attention_test)]),
percent_attention = mean(grade[q_type %in% attention_test]),
percent_attention = ifelse(is.nan(percent_attention), 1, percent_attention),
percent36 = mean(grade)*100,
percent30 = mean(grade[!(q_type %in% attention_test)]) *100,
mean_confidence = mean(confidence),
mean_confidence_right = mean(confidence[grade == 1]),
mean_confidence_wrong = mean(confidence[grade == 0])) %>%
ungroup() %>%
left_join(df_kapr_user, "u_id") %>%
left_join(df_kapr_page, "u_id") %>%
left_join(df_u_mode, "u_id")
df_u_question
df_u_key_info <-
df_u_question %>%
group_by(u_id, sample) %>%
summarise(grade36 = sum(grade),
grade30 = sum(grade[!(q_type %in% attention_test)]),
percent_attention = mean(grade[q_type %in% attention_test]),
percent_attention = ifelse(is.nan(percent_attention), 1, percent_attention),
percent36 = mean(grade)*100,
percent30 = mean(grade[!(q_type %in% attention_test)]) *100,
mean_confidence = mean(confidence),
mean_confidence_right = mean(confidence[grade == 1]),
mean_confidence_wrong = mean(confidence[grade == 0]),
total_kapr_from_questions = total_kapr_from_questions %>% mean()) %>%
ungroup() %>%
left_join(df_kapr_user, "u_id") %>%
left_join(df_kapr_page, "u_id") %>%
left_join(df_u_mode, "u_id") %>%
select(-total_kapr_from_questions, -total_kapr_from_pages)
df_u_key_info <-
df_u_question %>%
filter(u_id != 2) %>%
group_by(u_id, sample) %>%
summarise(grade36 = sum(grade),
grade30 = sum(grade[!(q_type %in% attention_test)]),
percent_attention = mean(grade[q_type %in% attention_test]),
percent_attention = ifelse(is.nan(percent_attention), 1, percent_attention),
percent36 = mean(grade)*100,
percent30 = mean(grade[!(q_type %in% attention_test)]) *100,
mean_confidence = mean(confidence),
mean_confidence_right = mean(confidence[grade == 1]),
mean_confidence_wrong = mean(confidence[grade == 0]),
total_kapr_from_questions = total_kapr_from_questions %>% mean()) %>%
ungroup() %>%
left_join(df_kapr_user, "u_id") %>%
left_join(df_kapr_page, "u_id") %>%
left_join(df_u_mode, "u_id") %>%
select(-total_kapr_from_questions, -total_kapr_from_pages)
df_u_key_info %>% write_csv("key_info.csv")
ls()
objects()
class(eval(objects()))
class(eval(objects()[1]))
expression("attention_test")
eval(expression("attention_test"))
substitute("attention_test")
parse(substitute("attention_test"))
parse("df_u_raw")
get("df_u_raw")
get("df_u_raw") %>% class()
for(i in objects()){
item <- get(i)
if("data.frame" %in% class(item)){
write_csv(paste0("parsed/", i, ".csv"))
}
}
for(i in objects()){
item <- get(i)
print(item)
if("data.frame" %in% class(item)){
write_csv(paste0("parsed/", i, ".csv"))
}
}
for(i in objects()){
item <- get(i)
print(item)
if("data.frame" %in% class(item)){
write_csv(item, paste0("parsed/", i, ".csv"))
}
}
df_u_raw <- read_csv("raw_data.csv.csv")
df_u_raw
df_u_raw %>%
filter(extra %>% str_detect("section2"))
df_u_raw %>%
filter(extra %>% str_detect("section"))
df_u_raw <- read_csv("raw_data.csv")
df_u_raw %>%
filter(extra %>% str_detect("section"))
df_u_raw %>%
filter(extra %>% str_detect("section2"))
df_u_raw %>%
filter(extra %>% str_detect("section2"),
type == "final_answer")
pacman::p_load(cricketr, yorkr)
vignette("yorkr")
?vignette()
vignette(package = "yorkr")
vignette(package = "cricketr")
vignette(package = "dplyr")
vignette("programming", package = "dplyr")
